[{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/app.controller.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/app.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/app.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/app.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/common.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/dto/pagination.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/filters/all-exceptions.filter.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/filters/all-exceptions.filter.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":23,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":23,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":86,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":86,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .method on an `any` value.","line":86,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":86,"endColumn":29},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":87,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":87,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .url on an `any` value.","line":87,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":88,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":88,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .ip on an `any` value.","line":88,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":88,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":89,"column":7,"nodeType":"Property","messageId":"anyAssignment","endLine":89,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .headers on an `any` value.","line":89,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":33},{"ruleId":"@typescript-eslint/no-unsafe-enum-comparison","severity":2,"message":"The two values in this comparison do not have a shared enum type.","line":95,"column":9,"nodeType":"BinaryExpression","messageId":"mismatchedCondition","endLine":95,"endColumn":26,"suggestions":[{"messageId":"replaceValueWithEnum","fix":{"range":[2807,2810],"text":"HttpStatus.INTERNAL_SERVER_ERROR"},"desc":"Replace with an enum value comparison."}]},{"ruleId":"@typescript-eslint/no-unsafe-enum-comparison","severity":2,"message":"The two values in this comparison do not have a shared enum type.","line":97,"column":16,"nodeType":"BinaryExpression","messageId":"mismatchedCondition","endLine":97,"endColumn":33,"suggestions":[{"messageId":"replaceValueWithEnum","fix":{"range":[2911,2914],"text":"HttpStatus.BAD_REQUEST"},"desc":"Replace with an enum value comparison."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  ExceptionFilter,\n  Catch,\n  ArgumentsHost,\n  HttpException,\n  HttpStatus,\n  Injectable,\n} from '@nestjs/common';\nimport { HttpAdapterHost } from '@nestjs/core';\nimport { LoggerService } from '../logger/logger.service';\n\n@Catch()\n@Injectable()\nexport class AllExceptionsFilter implements ExceptionFilter {\n  constructor(\n    private readonly httpAdapterHost: HttpAdapterHost,\n    private readonly logger: LoggerService,\n  ) {}\n\n  catch(exception: unknown, host: ArgumentsHost): void {\n    const { httpAdapter } = this.httpAdapterHost;\n    const ctx = host.switchToHttp();\n    const request = ctx.getRequest();\n\n    let httpStatus = HttpStatus.INTERNAL_SERVER_ERROR;\n    let message = 'Internal server error';\n    let error: string | undefined;\n    let stack: string | undefined;\n\n    if (exception instanceof HttpException) {\n      httpStatus = exception.getStatus();\n      const response = exception.getResponse();\n\n      if (typeof response === 'string') {\n        message = response;\n      } else {\n        const responseObj = response as Record<string, unknown>;\n        message = (responseObj.message as string) || exception.message;\n        error = responseObj.error as string | undefined;\n      }\n      stack = exception.stack;\n    } else if (exception instanceof Error) {\n      this.logger.error(\n        `Unhandled Error: ${exception.message}`,\n        exception.stack,\n        'AllExceptionsFilter',\n      );\n\n      message = exception.message || 'Internal server error';\n      stack = exception.stack;\n\n      // Handle common database errors\n      const dbError = exception as unknown as Record<string, unknown>;\n      if (dbError.code) {\n        switch (dbError.code as string) {\n          case '23505': // Duplicate key\n            httpStatus = HttpStatus.CONFLICT;\n            message = 'Duplicate entry';\n            break;\n          case '23503': // Foreign key violation\n            httpStatus = HttpStatus.BAD_REQUEST;\n            message = 'Referenced record does not exist';\n            break;\n          case '23502': // Not null violation\n            httpStatus = HttpStatus.BAD_REQUEST;\n            message = 'Required field is missing';\n            break;\n        }\n      }\n    } else {\n      const exceptionStr =\n        typeof exception === 'object' && exception !== null\n          ? JSON.stringify(exception)\n          : String(exception);\n\n      this.logger.error(\n        'Unknown exception occurred',\n        exceptionStr,\n        'AllExceptionsFilter',\n      );\n    }\n\n    // Log the error with context\n    const logContext = {\n      statusCode: httpStatus,\n      method: request.method,\n      url: request.url,\n      ip: request.ip,\n      userAgent: request.headers['user-agent'],\n      errorMessage: message,\n      error,\n      stack,\n    };\n\n    if (httpStatus >= 500) {\n      this.logger.logWithMeta('error', 'Server Error', logContext);\n    } else if (httpStatus >= 400) {\n      this.logger.logWithMeta('warn', 'Client Error', logContext);\n    }\n\n    const responseBody: Record<string, unknown> = {\n      statusCode: httpStatus,\n      timestamp: new Date().toISOString(),\n      path: httpAdapter.getRequestUrl(ctx.getRequest()),\n      message,\n      ...(error && { error }),\n    };\n\n    httpAdapter.reply(ctx.getResponse(), responseBody, httpStatus);\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/filters/http-exception.filter.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/guards/auth.guard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/guards/auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/guards/redis-rate-limit.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interceptors/cache.interceptor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interceptors/logging.interceptor.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interceptors/logging.interceptor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interceptors/response.interceptor.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interceptors/response.interceptor.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interfaces/paginated-response.interface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/interfaces/standard-response.interface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/logger/logger.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/logger/logger.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/logger/logger.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/middleware/http-logger.middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/common/services/pagination.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/app.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/database.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/env.validation.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/game.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/jwt.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/config/redis.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/database/migrations/1740345600000-AddIsAdminToUsers.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/database/seeds/admin-seed.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/health/health.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/main.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":14,"column":9,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":14,"endColumn":62},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `false | LoggerService | (\"debug\" | \"verbose\" | \"log\" | \"error\" | \"warn\" | \"fatal\")[]`.","line":15,"column":17,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":15,"endColumn":30}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NestFactory, HttpAdapterHost } from '@nestjs/core';\nimport { ValidationPipe } from '@nestjs/common';\nimport { ConfigService } from '@nestjs/config';\nimport helmet from 'helmet';\nimport { WINSTON_MODULE_NEST_PROVIDER } from 'nest-winston';\nimport { AppModule } from './app.module';\nimport { AllExceptionsFilter } from './common/filters/all-exceptions.filter';\nimport { LoggerService } from './common/logger/logger.service';\n\nasync function bootstrap() {\n  const app = await NestFactory.create(AppModule);\n\n  // Use Winston logger\n  const winstonLogger = app.get(WINSTON_MODULE_NEST_PROVIDER);\n  app.useLogger(winstonLogger);\n\n  const configService = app.get(ConfigService);\n\n  // Enable Helmet\n  app.use(helmet());\n\n  // Global validation pipe\n  app.useGlobalPipes(\n    new ValidationPipe({\n      whitelist: true,\n      forbidNonWhitelisted: true,\n      transform: true,\n    }),\n  );\n\n  // Global Exception Filter\n  const httpAdapterHost = app.get(HttpAdapterHost);\n  const loggerService = app.get(LoggerService);\n  app.useGlobalFilters(new AllExceptionsFilter(httpAdapterHost, loggerService));\n\n  // CORS configuration\n  app.enableCors({\n    origin: configService.get<string>('app.corsOrigin'),\n    credentials: true,\n    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE,OPTIONS',\n    allowedHeaders: 'Content-Type, Accept, Authorization',\n  });\n\n  // Global API prefix\n  const apiPrefix = configService.get<string>('app.apiPrefix') || 'api/v1';\n  app.setGlobalPrefix(apiPrefix);\n\n  const port = configService.get<number>('app.port') || 3000;\n  await app.listen(port);\n\n  const logger = app.get(LoggerService);\n  logger.log(\n    ` Application is running on: http://localhost:${port}`,\n    'Bootstrap',\n  );\n  logger.log(\n    ` API Documentation: http://localhost:${port}/${apiPrefix}`,\n    'Bootstrap',\n  );\n  logger.log(\n    `Environment: ${configService.get<string>('app.environment') || 'development'}`,\n    'Bootstrap',\n  );\n  logger.log(`Log Level: ${process.env.LOG_LEVEL || 'default'}`, 'Bootstrap');\n}\nvoid bootstrap();\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/admin-auth.controller.spec.ts","messages":[{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":8,"column":3,"nodeType":null,"messageId":"delete","endLine":8,"endColumn":5,"fix":{"range":[318,320],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":9,"column":3,"nodeType":null,"messageId":"delete","endLine":9,"endColumn":5,"fix":{"range":[359,361],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":11,"column":1,"nodeType":null,"messageId":"delete","endLine":11,"endColumn":3,"fix":{"range":[392,394],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":12,"column":5,"nodeType":null,"messageId":"delete","endLine":12,"endColumn":9,"fix":{"range":[426,430],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":13,"column":1,"nodeType":null,"messageId":"replace","endLine":13,"endColumn":9,"fix":{"range":[456,464],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":14,"column":3,"nodeType":null,"messageId":"delete","endLine":14,"endColumn":5,"fix":{"range":[484,486],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路` with `路路`","line":16,"column":1,"nodeType":null,"messageId":"replace","endLine":16,"endColumn":5,"fix":{"range":[490,494],"text":"  "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":17,"column":1,"nodeType":null,"messageId":"delete","endLine":17,"endColumn":5,"fix":{"range":[519,523],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":18,"column":1,"nodeType":null,"messageId":"replace","endLine":18,"endColumn":13,"fix":{"range":[590,602],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":19,"column":1,"nodeType":null,"messageId":"delete","endLine":19,"endColumn":7,"fix":{"range":[638,644],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":20,"column":9,"nodeType":null,"messageId":"delete","endLine":20,"endColumn":17,"fix":{"range":[671,679],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路路路路路` with `路路路路路路路路路路`","line":21,"column":1,"nodeType":null,"messageId":"replace","endLine":21,"endColumn":21,"fix":{"range":[681,701],"text":"          "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路路路路路` with `路路路路路路路路路路`","line":22,"column":1,"nodeType":null,"messageId":"replace","endLine":22,"endColumn":21,"fix":{"range":[723,743],"text":"          "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":23,"column":1,"nodeType":null,"messageId":"replace","endLine":23,"endColumn":17,"fix":{"range":[770,786],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":24,"column":1,"nodeType":null,"messageId":"replace","endLine":24,"endColumn":13,"fix":{"range":[789,801],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":25,"column":1,"nodeType":null,"messageId":"replace","endLine":25,"endColumn":9,"fix":{"range":[804,812],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":27,"column":1,"nodeType":null,"messageId":"delete","endLine":27,"endColumn":5,"fix":{"range":[827,831],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":28,"column":1,"nodeType":null,"messageId":"replace","endLine":28,"endColumn":9,"fix":{"range":[902,910],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":29,"column":1,"nodeType":null,"messageId":"delete","endLine":29,"endColumn":3,"fix":{"range":[962,964],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":31,"column":3,"nodeType":null,"messageId":"delete","endLine":31,"endColumn":5,"fix":{"range":[973,975],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":32,"column":1,"nodeType":null,"messageId":"delete","endLine":32,"endColumn":5,"fix":{"range":[1007,1011],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":33,"column":3,"nodeType":null,"messageId":"delete","endLine":33,"endColumn":5,"fix":{"range":[1051,1053],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":35,"column":1,"nodeType":null,"messageId":"delete","endLine":35,"endColumn":3,"fix":{"range":[1058,1060],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":36,"column":1,"nodeType":null,"messageId":"replace","endLine":36,"endColumn":9,"fix":{"range":[1088,1096],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":37,"column":7,"nodeType":null,"messageId":"delete","endLine":37,"endColumn":13,"fix":{"range":[1141,1147],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":38,"column":1,"nodeType":null,"messageId":"replace","endLine":38,"endColumn":13,"fix":{"range":[1175,1187],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":39,"column":5,"nodeType":null,"messageId":"delete","endLine":39,"endColumn":9,"fix":{"range":[1216,1220],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":41,"column":1,"nodeType":null,"messageId":"delete","endLine":41,"endColumn":5,"fix":{"range":[1224,1228],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":42,"column":7,"nodeType":null,"messageId":"delete","endLine":42,"endColumn":13,"fix":{"range":[1299,1305],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":43,"column":1,"nodeType":null,"messageId":"replace","endLine":43,"endColumn":17,"fix":{"range":[1324,1340],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":44,"column":1,"nodeType":null,"messageId":"delete","endLine":44,"endColumn":9,"fix":{"range":[1347,1355],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":45,"column":1,"nodeType":null,"messageId":"replace","endLine":45,"endColumn":17,"fix":{"range":[1391,1407],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":46,"column":1,"nodeType":null,"messageId":"replace","endLine":46,"endColumn":17,"fix":{"range":[1422,1438],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":47,"column":7,"nodeType":null,"messageId":"delete","endLine":47,"endColumn":13,"fix":{"range":[1460,1466],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":48,"column":1,"nodeType":null,"messageId":"replace","endLine":48,"endColumn":13,"fix":{"range":[1469,1481],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":49,"column":1,"nodeType":null,"messageId":"replace","endLine":49,"endColumn":17,"fix":{"range":[1502,1518],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":50,"column":1,"nodeType":null,"messageId":"replace","endLine":50,"endColumn":17,"fix":{"range":[1547,1563],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":51,"column":1,"nodeType":null,"messageId":"replace","endLine":51,"endColumn":13,"fix":{"range":[1594,1606],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":53,"column":1,"nodeType":null,"messageId":"delete","endLine":53,"endColumn":7,"fix":{"range":[1610,1616],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":54,"column":1,"nodeType":null,"messageId":"replace","endLine":54,"endColumn":13,"fix":{"range":[1681,1693],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":56,"column":1,"nodeType":null,"messageId":"delete","endLine":56,"endColumn":7,"fix":{"range":[1747,1753],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":58,"column":7,"nodeType":null,"messageId":"delete","endLine":58,"endColumn":13,"fix":{"range":[1820,1826],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":59,"column":1,"nodeType":null,"messageId":"replace","endLine":59,"endColumn":13,"fix":{"range":[1862,1874],"text":"      "}},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":59,"column":20,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":59,"endColumn":45},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":60,"column":9,"nodeType":null,"messageId":"delete","endLine":60,"endColumn":17,"fix":{"range":[1938,1946],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":61,"column":1,"nodeType":null,"messageId":"replace","endLine":61,"endColumn":17,"fix":{"range":[1967,1983],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":62,"column":1,"nodeType":null,"messageId":"delete","endLine":62,"endColumn":7,"fix":{"range":[2007,2013],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":63,"column":7,"nodeType":null,"messageId":"delete","endLine":63,"endColumn":13,"fix":{"range":[2028,2034],"text":""}},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":63,"column":20,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":63,"endColumn":37},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":64,"column":9,"nodeType":null,"messageId":"delete","endLine":64,"endColumn":17,"fix":{"range":[2091,2099],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":65,"column":1,"nodeType":null,"messageId":"delete","endLine":65,"endColumn":9,"fix":{"range":[2116,2124],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":66,"column":9,"nodeType":null,"messageId":"delete","endLine":66,"endColumn":17,"fix":{"range":[2163,2171],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":67,"column":1,"nodeType":null,"messageId":"replace","endLine":67,"endColumn":17,"fix":{"range":[2192,2208],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":68,"column":7,"nodeType":null,"messageId":"delete","endLine":68,"endColumn":13,"fix":{"range":[2243,2249],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":69,"column":1,"nodeType":null,"messageId":"replace","endLine":69,"endColumn":9,"fix":{"range":[2253,2261],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路`","line":71,"column":1,"nodeType":null,"messageId":"delete","endLine":71,"endColumn":5,"fix":{"range":[2266,2270],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":72,"column":1,"nodeType":null,"messageId":"replace","endLine":72,"endColumn":13,"fix":{"range":[2352,2364],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":74,"column":1,"nodeType":null,"messageId":"delete","endLine":74,"endColumn":7,"fix":{"range":[2420,2426],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":75,"column":1,"nodeType":null,"messageId":"replace","endLine":75,"endColumn":17,"fix":{"range":[2495,2511],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":76,"column":7,"nodeType":null,"messageId":"delete","endLine":76,"endColumn":13,"fix":{"range":[2540,2546],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路`","line":77,"column":1,"nodeType":null,"messageId":"delete","endLine":77,"endColumn":7,"fix":{"range":[2549,2555],"text":""}},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":77,"column":20,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":77,"endColumn":45},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路路路路路` with `路路路路路路路路`","line":78,"column":1,"nodeType":null,"messageId":"replace","endLine":78,"endColumn":17,"fix":{"range":[2617,2633],"text":"        "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路路路路路路路`","line":79,"column":1,"nodeType":null,"messageId":"delete","endLine":79,"endColumn":9,"fix":{"range":[2654,2662],"text":""}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路路路路路` with `路路路路路路`","line":80,"column":1,"nodeType":null,"messageId":"replace","endLine":80,"endColumn":13,"fix":{"range":[2694,2706],"text":"      "}},{"ruleId":"prettier/prettier","severity":2,"message":"Replace `路路路路路路路路` with `路路路路`","line":81,"column":1,"nodeType":null,"messageId":"replace","endLine":81,"endColumn":9,"fix":{"range":[2709,2717],"text":"    "}},{"ruleId":"prettier/prettier","severity":2,"message":"Delete `路路`","line":82,"column":1,"nodeType":null,"messageId":"delete","endLine":82,"endColumn":3,"fix":{"range":[2721,2723],"text":""}}],"suppressedMessages":[],"errorCount":67,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":64,"fixableWarningCount":0,"source":"import { Test, TestingModule } from '@nestjs/testing';\nimport { AdminAuthController } from './admin-auth.controller';\nimport { AuthService } from './auth.service';\nimport { UnauthorizedException } from '@nestjs/common';\nimport { AdminLoginDto } from './dto/admin-login.dto';\n\ndescribe('AdminAuthController', () => {\n    let controller: AdminAuthController;\n    let authService: AuthService;\n\n    const mockAuthService = {\n        validateAdmin: jest.fn(),\n        login: jest.fn(),\n    };\n\n    beforeEach(async () => {\n        const module: TestingModule = await Test.createTestingModule({\n            controllers: [AdminAuthController],\n            providers: [\n                {\n                    provide: AuthService,\n                    useValue: mockAuthService,\n                },\n            ],\n        }).compile();\n\n        controller = module.get<AdminAuthController>(AdminAuthController);\n        authService = module.get<AuthService>(AuthService);\n    });\n\n    it('should be defined', () => {\n        expect(controller).toBeDefined();\n    });\n\n    describe('login', () => {\n        const adminLoginDto: AdminLoginDto = {\n            email: 'admin@example.com',\n            password: 'password123',\n        };\n\n        it('should return tokens on successful login', async () => {\n            const mockUser = {\n                id: 1,\n                email: 'admin@example.com',\n                role: 'admin',\n                is_admin: true,\n            };\n            const mockTokens = {\n                accessToken: 'access_token',\n                refreshToken: 'refresh_token',\n            };\n\n            mockAuthService.validateAdmin.mockResolvedValue(mockUser);\n            mockAuthService.login.mockResolvedValue(mockTokens);\n\n            const result = await controller.login(adminLoginDto);\n\n            expect(result).toEqual(mockTokens);\n            expect(authService.validateAdmin).toHaveBeenCalledWith(\n                adminLoginDto.email,\n                adminLoginDto.password,\n            );\n            expect(authService.login).toHaveBeenCalledWith({\n                id: mockUser.id,\n                email: mockUser.email,\n                role: mockUser.role,\n                is_admin: mockUser.is_admin,\n            });\n        });\n\n        it('should throw UnauthorizedException on invalid credentials', async () => {\n            mockAuthService.validateAdmin.mockResolvedValue(null);\n\n            await expect(controller.login(adminLoginDto)).rejects.toThrow(\n                UnauthorizedException,\n            );\n            expect(authService.validateAdmin).toHaveBeenCalledWith(\n                adminLoginDto.email,\n                adminLoginDto.password,\n            );\n        });\n    });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/admin-auth.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/auth.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `{ id: number; email: string; role: string; is_admin: boolean; }`.","line":31,"column":35,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":31,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":31,"column":39,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":31,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `number`.","line":51,"column":36,"nodeType":"MemberExpression","messageId":"unsafeArgument","endLine":51,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":51,"column":40,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":51,"endColumn":44}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  Controller,\n  Post,\n  Body,\n  UseGuards,\n  Request,\n  HttpCode,\n  HttpStatus,\n} from '@nestjs/common';\nimport { AuthService } from './auth.service';\nimport { UsersService } from '../users/users.service';\nimport { CreateUserDto } from '../users/dto/create-user.dto';\nimport { LocalAuthGuard } from './guards/local-auth.guard';\nimport { JwtAuthGuard } from './guards/jwt-auth.guard';\nimport { RefreshTokenDto } from './dto/refresh-token.dto';\nimport { WalletLoginDto } from './dto/wallet-login.dto';\n\n@Controller('auth')\nexport class AuthController {\n  constructor(\n    private readonly authService: AuthService,\n    private readonly usersService: UsersService,\n  ) {}\n\n  @UseGuards(LocalAuthGuard)\n  @Post('login')\n  @HttpCode(HttpStatus.OK)\n  async login(\n    @Request() req, // Type changed to 'any' or inferred\n  ) {\n    return this.authService.login(req.user);\n  }\n\n  @Post('refresh')\n  @HttpCode(HttpStatus.OK)\n  async refresh(@Body() refreshTokenDto: RefreshTokenDto) {\n    return this.authService.refreshTokens(refreshTokenDto.refreshToken);\n  }\n\n  @Post('wallet-login')\n  @HttpCode(HttpStatus.OK)\n  async walletLogin(@Body() body: WalletLoginDto) {\n    return this.authService.walletLogin(body.address, body.chain);\n  }\n\n  @UseGuards(JwtAuthGuard)\n  @Post('logout')\n  @HttpCode(HttpStatus.OK)\n  async logout(@Request() req) {\n    // Type changed to 'any' or inferred\n    return this.authService.logout(req.user.id);\n  }\n\n  @Post('register')\n  @HttpCode(HttpStatus.CREATED)\n  async register(@Body() createUserDto: CreateUserDto) {\n    // Type fixed\n    return this.usersService.create(createUserDto); // Service and method call corrected\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/auth.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/auth.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/auth.service.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_password' is assigned a value but never used.","line":42,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":42,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'_password' is assigned a value but never used.","line":69,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":69,"endColumn":34,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/decorators/current-user.decorator.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":6,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":6,"endColumn":52},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":7,"column":20,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":7,"endColumn":24}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createParamDecorator, ExecutionContext } from '@nestjs/common';\nimport { JwtPayload } from '../interfaces/jwt-payload.interface';\n\nexport const CurrentUser = createParamDecorator(\n  (data: unknown, ctx: ExecutionContext): JwtPayload => {\n    const request = ctx.switchToHttp().getRequest();\n    return request.user as JwtPayload;\n  },\n);\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/decorators/roles.decorator.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/dto/admin-login.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/dto/login.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/dto/refresh-token.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/dto/wallet-login.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/entities/refresh-token.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/enums/role.enum.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/guards/admin.guard.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/guards/admin.guard.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":20,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":20,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":21,"column":11,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":21,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":21,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":21,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .is_admin on an `any` value.","line":23,"column":23,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":23,"endColumn":31}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  Injectable,\n  CanActivate,\n  ExecutionContext,\n  ForbiddenException,\n} from '@nestjs/common';\nimport { Observable } from 'rxjs';\n\n/**\n * AdminGuard - Use this guard to restrict access to admin-only endpoints.\n * It checks if the authenticated user has the is_admin flag set to true.\n * Apply with @UseGuards(AdminGuard) decorator.\n * Usually paired with @UseGuards(JwtAuthGuard) to ensure the user is authenticated first.\n */\n@Injectable()\nexport class AdminGuard implements CanActivate {\n  canActivate(\n    context: ExecutionContext,\n  ): boolean | Promise<boolean> | Observable<boolean> {\n    const request = context.switchToHttp().getRequest();\n    const user = request.user;\n\n    if (!user || user.is_admin !== true) {\n      throw new ForbiddenException('Access denied. Admin role required.');\n    }\n\n    return true;\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/guards/jwt-auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/guards/local-auth.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/guards/roles.guard.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/interfaces/jwt-payload.interface.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/strategies/jwt.strategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/auth/strategies/local.strategy.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/chance.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/chance.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/chance.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/dto/create-chance.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/entities/chance.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/chance/enums/chance-type.enum.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/change-chest.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/community-chest.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/community-chest.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/community-chest.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/community-chest.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/dto/create-community-chest.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/dto/get-community-chest-list.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/entities/change-chest.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/community-chest/entities/community-chest.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/dto/get-notifications-query.dto.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":34,"column":5,"nodeType":"ReturnStatement","messageId":"unsafeReturn","endLine":34,"endColumn":18}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  IsOptional,\n  IsBoolean,\n  IsEnum,\n  IsInt,\n  Min,\n  Max,\n} from 'class-validator';\nimport { Transform, Type } from 'class-transformer';\nimport { ApiPropertyOptional } from '@nestjs/swagger';\nimport { NotificationType } from '../entities/notification.entity';\n\nexport class GetNotificationsQueryDto {\n  @ApiPropertyOptional({ default: 1, description: 'Page number (1-based)' })\n  @IsOptional()\n  @Type(() => Number)\n  @IsInt()\n  @Min(1)\n  page?: number = 1;\n\n  @ApiPropertyOptional({ default: 20, description: 'Items per page (max 100)' })\n  @IsOptional()\n  @Type(() => Number)\n  @IsInt()\n  @Min(1)\n  @Max(100)\n  limit?: number = 20;\n\n  @ApiPropertyOptional({ description: 'Filter by read status' })\n  @IsOptional()\n  @Transform(({ value }) => {\n    if (value === 'true') return true;\n    if (value === 'false') return false;\n    return value;\n  })\n  @IsBoolean()\n  isRead?: boolean;\n\n  @ApiPropertyOptional({\n    enum: NotificationType,\n    description: 'Filter by notification type',\n  })\n  @IsOptional()\n  @IsEnum(NotificationType)\n  type?: NotificationType;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/dto/notification-response.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/dto/paginated-notifications-response.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/dto/unread-count-response.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/entities/notification.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.controller.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'PaginationMetaDto' is defined but never used.","line":10,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":10,"endColumn":20,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"PaginationMetaDto"},"fix":{"range":[500,521],"text":""},"desc":"Remove unused variable \"PaginationMetaDto\"."}]},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":79,"column":56,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":79,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":98,"column":41,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":98,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":116,"column":41,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":116,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":128,"column":56,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":128,"endColumn":71},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":144,"column":39,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":144,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":154,"column":54,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":154,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":162,"column":54,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":162,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `JwtPayload`.","line":170,"column":54,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":170,"endColumn":69}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/notifications/tests/notifications.controller.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { NotificationsController } from './notifications.controller';\nimport { NotificationsService } from './notifications.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { NotificationType } from './entities/notification.entity';\nimport { GetNotificationsQueryDto } from './dto/get-notifications-query.dto';\nimport {\n  PaginatedNotificationsResponseDto,\n  PaginationMetaDto,\n} from './dto/paginated-notifications-response.dto';\n\n//  Helpers \n\nconst mockUser = { sub: 'user-uuid-1', email: 'user@example.com' };\n\nconst makePaginatedResponse = (\n  overrides: Partial<PaginatedNotificationsResponseDto> = {},\n): PaginatedNotificationsResponseDto => ({\n  data: [\n    {\n      id: 'notif-uuid-1',\n      userId: 'user-uuid-1',\n      type: NotificationType.SYSTEM,\n      title: 'Test',\n      content: 'Test content',\n      isRead: false,\n      createdAt: new Date('2024-01-01T00:00:00.000Z'),\n    },\n  ],\n  meta: {\n    page: 1,\n    limit: 20,\n    total: 1,\n    totalPages: 1,\n    hasNextPage: false,\n    hasPreviousPage: false,\n  },\n  ...overrides,\n});\n\n//  Mock Service \n\nconst mockNotificationsService = {\n  findAllForUser: jest.fn(),\n  getUnreadCount: jest.fn(),\n};\n\n//  Tests \n\ndescribe('NotificationsController', () => {\n  let controller: NotificationsController;\n\n  beforeEach(async () => {\n    jest.clearAllMocks();\n\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [NotificationsController],\n      providers: [\n        { provide: NotificationsService, useValue: mockNotificationsService },\n      ],\n    })\n      // Bypass JwtAuthGuard in unit tests  integration tests cover auth\n      .overrideGuard(JwtAuthGuard)\n      .useValue({ canActivate: () => true })\n      .compile();\n\n    controller = module.get<NotificationsController>(NotificationsController);\n  });\n\n  //  GET /api/notifications \n\n  describe('getNotifications', () => {\n    it('should call service.findAllForUser with user id and query params', async () => {\n      const expected = makePaginatedResponse();\n      mockNotificationsService.findAllForUser.mockResolvedValue(expected);\n\n      const query: GetNotificationsQueryDto = { page: 1, limit: 20 };\n      const result = await controller.getNotifications(mockUser as any, query);\n\n      expect(mockNotificationsService.findAllForUser).toHaveBeenCalledWith(\n        mockUser.sub,\n        query,\n      );\n      expect(result).toBe(expected);\n    });\n\n    it('should pass isRead filter to service', async () => {\n      mockNotificationsService.findAllForUser.mockResolvedValue(\n        makePaginatedResponse({ data: [] }),\n      );\n\n      const query: GetNotificationsQueryDto = {\n        page: 1,\n        limit: 20,\n        isRead: false,\n      };\n      await controller.getNotifications(mockUser as any, query);\n\n      expect(mockNotificationsService.findAllForUser).toHaveBeenCalledWith(\n        mockUser.sub,\n        expect.objectContaining({ isRead: false }),\n      );\n    });\n\n    it('should pass type filter to service', async () => {\n      mockNotificationsService.findAllForUser.mockResolvedValue(\n        makePaginatedResponse({ data: [] }),\n      );\n\n      const query: GetNotificationsQueryDto = {\n        page: 1,\n        limit: 20,\n        type: NotificationType.MENTION,\n      };\n      await controller.getNotifications(mockUser as any, query);\n\n      expect(mockNotificationsService.findAllForUser).toHaveBeenCalledWith(\n        mockUser.sub,\n        expect.objectContaining({ type: NotificationType.MENTION }),\n      );\n    });\n\n    it('should return the paginated response from service', async () => {\n      const expected = makePaginatedResponse();\n      mockNotificationsService.findAllForUser.mockResolvedValue(expected);\n\n      const result = await controller.getNotifications(mockUser as any, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.data).toHaveLength(1);\n      expect(result.meta.total).toBe(1);\n    });\n  });\n\n  //  GET /api/notifications/count \n\n  describe('getUnreadCount', () => {\n    it('should call service.getUnreadCount with user id', async () => {\n      mockNotificationsService.getUnreadCount.mockResolvedValue(5);\n\n      await controller.getUnreadCount(mockUser as any);\n\n      expect(mockNotificationsService.getUnreadCount).toHaveBeenCalledWith(\n        mockUser.sub,\n      );\n    });\n\n    it('should return { count: number } shape', async () => {\n      mockNotificationsService.getUnreadCount.mockResolvedValue(5);\n\n      const result = await controller.getUnreadCount(mockUser as any);\n\n      expect(result).toEqual({ count: 5 });\n    });\n\n    it('should return count of 0 when no unread notifications', async () => {\n      mockNotificationsService.getUnreadCount.mockResolvedValue(0);\n\n      const result = await controller.getUnreadCount(mockUser as any);\n\n      expect(result).toEqual({ count: 0 });\n    });\n\n    it('should always wrap the number in a count object regardless of value', async () => {\n      mockNotificationsService.getUnreadCount.mockResolvedValue(99);\n\n      const result = await controller.getUnreadCount(mockUser as any);\n\n      expect(result).toHaveProperty('count');\n      expect(typeof result.count).toBe('number');\n      expect(result.count).toBe(99);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.e2e.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":68,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":68,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":68,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":68,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":68,"column":23,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":68,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .switchToHttp on an `any` value.","line":68,"column":31,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .getRequest on an `any` value.","line":68,"column":46,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":56},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":69,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":69,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":98,"column":15,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":98,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":98,"column":46,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":98,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":105,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":105,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":106,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":106,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":110,"column":15,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":110,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":110,"column":38,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":110,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":114,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":114,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":114,"column":28,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":114,"endColumn":32},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":125,"column":15,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":125,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":125,"column":38,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":125,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":129,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":130,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":130,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":131,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":131,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":132,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":132,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":133,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":133,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .meta on an `any` value.","line":134,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":134,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":138,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":138,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":146,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":146,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":154,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":154,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":167,"column":23,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":167,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":167,"column":46,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":167,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .data on an `any` value.","line":172,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":172,"endColumn":23},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":176,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":176,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":184,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":184,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":196,"column":23,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":196,"endColumn":27},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":196,"column":46,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":196,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .count on an `any` value.","line":202,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":202,"endColumn":31},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":208,"column":15,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":208,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":208,"column":38,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":208,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .count on an `any` value.","line":212,"column":19,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":212,"endColumn":24},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe object destructuring of a property with an `any` value.","line":218,"column":15,"nodeType":"Identifier","messageId":"unsafeObjectPattern","endLine":218,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":218,"column":38,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":218,"endColumn":57},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":226,"column":40,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":226,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":251,"column":34,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":251,"endColumn":59},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `App`.","line":254,"column":34,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":254,"endColumn":59}],"suppressedMessages":[],"errorCount":26,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/notifications/tests/notifications.e2e.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { INestApplication, ValidationPipe } from '@nestjs/common';\nimport request from 'supertest';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { NotificationsModule } from './notifications.module';\nimport { Notification, NotificationType } from './entities/notification.entity';\n\n//  Fixtures \n\nconst USER_ID = 'user-e2e-uuid';\n\nconst mockNotifications: Notification[] = [\n  {\n    id: 'n1',\n    userId: USER_ID,\n    type: NotificationType.SYSTEM,\n    title: 'System Alert',\n    content: 'Something happened.',\n    isRead: false,\n    createdAt: new Date('2024-06-01T10:00:00.000Z'),\n  },\n  {\n    id: 'n2',\n    userId: USER_ID,\n    type: NotificationType.MENTION,\n    title: 'You were mentioned',\n    content: '@you was mentioned in a post.',\n    isRead: true,\n    createdAt: new Date('2024-06-01T09:00:00.000Z'),\n  },\n];\n\n//  Mock Repository \n\nconst buildQb = (data: Notification[], count: number) => ({\n  where: jest.fn().mockReturnThis(),\n  andWhere: jest.fn().mockReturnThis(),\n  orderBy: jest.fn().mockReturnThis(),\n  skip: jest.fn().mockReturnThis(),\n  take: jest.fn().mockReturnThis(),\n  getManyAndCount: jest.fn().mockResolvedValue([data, count]),\n});\n\nconst mockRepository = {\n  createQueryBuilder: jest.fn(() =>\n    buildQb(mockNotifications, mockNotifications.length),\n  ),\n  count: jest.fn().mockResolvedValue(1), // 1 unread\n};\n\n//  E2E Suite \n\ndescribe('NotificationsController (E2E)', () => {\n  let app: INestApplication;\n\n  beforeAll(async () => {\n    const moduleFixture: TestingModule = await Test.createTestingModule({\n      imports: [NotificationsModule],\n    })\n      .overrideProvider(getRepositoryToken(Notification))\n      .useValue(mockRepository)\n      // Simulate authenticated user  real auth tested separately\n      .overrideGuard(JwtAuthGuard)\n      .useValue({\n        canActivate: (context) => {\n          const req = context.switchToHttp().getRequest();\n          req.user = { sub: USER_ID, email: 'user@example.com' };\n          return true;\n        },\n      })\n      .compile();\n\n    app = moduleFixture.createNestApplication();\n    app.useGlobalPipes(\n      new ValidationPipe({ transform: true, whitelist: true }),\n    );\n    await app.init();\n  });\n\n  afterAll(async () => {\n    await app.close();\n  });\n\n  beforeEach(() => {\n    jest.clearAllMocks();\n    mockRepository.createQueryBuilder.mockImplementation(() =>\n      buildQb(mockNotifications, mockNotifications.length),\n    );\n    mockRepository.count.mockResolvedValue(1);\n  });\n\n  //  GET /api/notifications \n\n  describe('GET /api/notifications', () => {\n    it('should return 200 with paginated notifications', async () => {\n      const { body, status } = await request(app.getHttpServer()).get(\n        '/api/notifications',\n      );\n\n      expect(status).toBe(200);\n      expect(body).toHaveProperty('data');\n      expect(body).toHaveProperty('meta');\n      expect(Array.isArray(body.data)).toBe(true);\n      expect(body.data).toHaveLength(2);\n    });\n\n    it('should include all expected notification fields', async () => {\n      const { body } = await request(app.getHttpServer()).get(\n        '/api/notifications',\n      );\n\n      const [first] = body.data;\n      expect(first).toHaveProperty('id');\n      expect(first).toHaveProperty('userId');\n      expect(first).toHaveProperty('type');\n      expect(first).toHaveProperty('title');\n      expect(first).toHaveProperty('content');\n      expect(first).toHaveProperty('isRead');\n      expect(first).toHaveProperty('createdAt');\n    });\n\n    it('should include correct pagination meta fields', async () => {\n      const { body } = await request(app.getHttpServer()).get(\n        '/api/notifications',\n      );\n\n      expect(body.meta).toHaveProperty('page');\n      expect(body.meta).toHaveProperty('limit');\n      expect(body.meta).toHaveProperty('total');\n      expect(body.meta).toHaveProperty('totalPages');\n      expect(body.meta).toHaveProperty('hasNextPage');\n      expect(body.meta).toHaveProperty('hasPreviousPage');\n    });\n\n    it('should accept page and limit query params', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        '/api/notifications?page=2&limit=10',\n      );\n\n      expect(status).toBe(200);\n    });\n\n    it('should return 400 for invalid page (non-numeric)', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        '/api/notifications?page=abc',\n      );\n\n      expect(status).toBe(400);\n    });\n\n    it('should return 400 for limit exceeding max (100)', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        '/api/notifications?limit=999',\n      );\n\n      expect(status).toBe(400);\n    });\n\n    it('should accept isRead=false query param', async () => {\n      const unread = [mockNotifications[0]];\n      mockRepository.createQueryBuilder.mockImplementation(() =>\n        buildQb(unread, unread.length),\n      );\n\n      const { status, body } = await request(app.getHttpServer()).get(\n        '/api/notifications?isRead=false',\n      );\n\n      expect(status).toBe(200);\n      expect(body.data).toHaveLength(1);\n    });\n\n    it('should accept type query param', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        `/api/notifications?type=${NotificationType.SYSTEM}`,\n      );\n\n      expect(status).toBe(200);\n    });\n\n    it('should return 400 for invalid notification type', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        '/api/notifications?type=INVALID_TYPE',\n      );\n\n      expect(status).toBe(400);\n    });\n  });\n\n  //  GET /api/notifications/count \n\n  describe('GET /api/notifications/count', () => {\n    it('should return 200 with { count: number }', async () => {\n      const { status, body } = await request(app.getHttpServer()).get(\n        '/api/notifications/count',\n      );\n\n      expect(status).toBe(200);\n      expect(body).toHaveProperty('count');\n      expect(typeof body.count).toBe('number');\n    });\n\n    it('should return the correct unread count', async () => {\n      mockRepository.count.mockResolvedValue(3);\n\n      const { body } = await request(app.getHttpServer()).get(\n        '/api/notifications/count',\n      );\n\n      expect(body.count).toBe(3);\n    });\n\n    it('should return count 0 when there are no unread notifications', async () => {\n      mockRepository.count.mockResolvedValue(0);\n\n      const { body } = await request(app.getHttpServer()).get(\n        '/api/notifications/count',\n      );\n\n      expect(body).toEqual({ count: 0 });\n    });\n\n    it('should not accept query params and still return 200', async () => {\n      const { status } = await request(app.getHttpServer()).get(\n        '/api/notifications/count?extra=ignored',\n      );\n\n      expect(status).toBe(200);\n    });\n  });\n\n  //  Auth Guard \n\n  describe('Auth protection', () => {\n    it('should return 401 when JwtAuthGuard rejects', async () => {\n      // Rebuild app with a rejecting guard for this specific test\n      const moduleRef = await Test.createTestingModule({\n        imports: [NotificationsModule],\n      })\n        .overrideProvider(getRepositoryToken(Notification))\n        .useValue(mockRepository)\n        .overrideGuard(JwtAuthGuard)\n        .useValue({ canActivate: () => false })\n        .compile();\n\n      const unauthApp = moduleRef.createNestApplication();\n      await unauthApp.init();\n\n      const res1 = await request(unauthApp.getHttpServer()).get(\n        '/api/notifications',\n      );\n      const res2 = await request(unauthApp.getHttpServer()).get(\n        '/api/notifications/count',\n      );\n\n      expect(res1.status).toBe(403); // Forbidden when canActivate returns false without throwing\n      expect(res2.status).toBe(403);\n\n      await unauthApp.close();\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":122,"column":57,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":122,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .includes on an `any` value.","line":122,"column":59,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":122,"endColumn":67}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/notifications/tests/notifications.service.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { SelectQueryBuilder } from 'typeorm';\nimport { NotificationsService } from './notifications.service';\nimport { Notification, NotificationType } from './entities/notification.entity';\nimport { GetNotificationsQueryDto } from './dto/get-notifications-query.dto';\n\n//  Factory Helpers \n\nconst makeNotification = (\n  overrides: Partial<Notification> = {},\n): Notification =>\n  ({\n    id: 'notif-uuid-1',\n    userId: 'user-uuid-1',\n    type: NotificationType.SYSTEM,\n    title: 'Test Notification',\n    content: 'This is a test notification.',\n    isRead: false,\n    createdAt: new Date('2024-01-01T00:00:00.000Z'),\n    ...overrides,\n  }) as Notification;\n\n//  Mock Repository \n\nconst createMockQueryBuilder = (\n  results: Notification[],\n  count: number,\n): Partial<SelectQueryBuilder<Notification>> => {\n  const qb: Partial<SelectQueryBuilder<Notification>> = {\n    where: jest.fn().mockReturnThis(),\n    andWhere: jest.fn().mockReturnThis(),\n    orderBy: jest.fn().mockReturnThis(),\n    skip: jest.fn().mockReturnThis(),\n    take: jest.fn().mockReturnThis(),\n    getManyAndCount: jest.fn().mockResolvedValue([results, count]),\n  };\n  return qb;\n};\n\nconst mockRepository = {\n  createQueryBuilder: jest.fn(),\n  count: jest.fn(),\n};\n\n//  Tests \n\ndescribe('NotificationsService', () => {\n  let service: NotificationsService;\n\n  beforeEach(async () => {\n    jest.clearAllMocks();\n\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        NotificationsService,\n        {\n          provide: getRepositoryToken(Notification),\n          useValue: mockRepository,\n        },\n      ],\n    }).compile();\n\n    service = module.get<NotificationsService>(NotificationsService);\n  });\n\n  //  findAllForUser \n\n  describe('findAllForUser', () => {\n    const userId = 'user-uuid-1';\n\n    it('should return paginated notifications with correct meta', async () => {\n      const notifications = [\n        makeNotification(),\n        makeNotification({ id: 'notif-uuid-2' }),\n      ];\n      const total = 42;\n      const qb = createMockQueryBuilder(notifications, total);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      const query: GetNotificationsQueryDto = { page: 1, limit: 20 };\n      const result = await service.findAllForUser(userId, query);\n\n      expect(result.data).toHaveLength(2);\n      expect(result.data[0].id).toBe('notif-uuid-1');\n      expect(result.meta).toEqual({\n        page: 1,\n        limit: 20,\n        total: 42,\n        totalPages: 3,\n        hasNextPage: true,\n        hasPreviousPage: false,\n      });\n    });\n\n    it('should apply isRead filter when provided', async () => {\n      const qb = createMockQueryBuilder([], 0);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      await service.findAllForUser(userId, {\n        page: 1,\n        limit: 20,\n        isRead: false,\n      });\n\n      expect(qb.andWhere).toHaveBeenCalledWith(\n        'notification.isRead = :isRead',\n        {\n          isRead: false,\n        },\n      );\n    });\n\n    it('should NOT apply isRead filter when undefined', async () => {\n      const qb = createMockQueryBuilder([], 0);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      await service.findAllForUser(userId, { page: 1, limit: 20 });\n\n      const andWhereCalls = (qb.andWhere as jest.Mock).mock.calls;\n      const hasIsReadCall = andWhereCalls.some(([q]) => q.includes('isRead'));\n      expect(hasIsReadCall).toBe(false);\n    });\n\n    it('should apply type filter when provided', async () => {\n      const qb = createMockQueryBuilder([], 0);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      await service.findAllForUser(userId, {\n        page: 1,\n        limit: 20,\n        type: NotificationType.SYSTEM,\n      });\n\n      expect(qb.andWhere).toHaveBeenCalledWith('notification.type = :type', {\n        type: NotificationType.SYSTEM,\n      });\n    });\n\n    it('should correctly calculate pagination offset on page 3', async () => {\n      const qb = createMockQueryBuilder([], 0);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      await service.findAllForUser(userId, { page: 3, limit: 10 });\n\n      expect(qb.skip).toHaveBeenCalledWith(20); // (3-1) * 10\n      expect(qb.take).toHaveBeenCalledWith(10);\n    });\n\n    it('should set hasPreviousPage correctly on page 2', async () => {\n      const qb = createMockQueryBuilder([], 50);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      const result = await service.findAllForUser(userId, {\n        page: 2,\n        limit: 20,\n      });\n\n      expect(result.meta.hasPreviousPage).toBe(true);\n      expect(result.meta.hasNextPage).toBe(true);\n    });\n\n    it('should set hasNextPage=false on the last page', async () => {\n      const qb = createMockQueryBuilder([], 20);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      const result = await service.findAllForUser(userId, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.meta.hasNextPage).toBe(false);\n      expect(result.meta.totalPages).toBe(1);\n    });\n\n    it('should return empty data array when no notifications exist', async () => {\n      const qb = createMockQueryBuilder([], 0);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      const result = await service.findAllForUser(userId, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.data).toEqual([]);\n      expect(result.meta.total).toBe(0);\n      expect(result.meta.totalPages).toBe(0);\n    });\n\n    it('should map notification entity fields to response DTO correctly', async () => {\n      const notification = makeNotification({\n        type: NotificationType.TOKEN_RECEIVED,\n        title: 'Token Received',\n        isRead: true,\n      });\n      const qb = createMockQueryBuilder([notification], 1);\n      mockRepository.createQueryBuilder.mockReturnValue(qb);\n\n      const result = await service.findAllForUser(userId, {\n        page: 1,\n        limit: 20,\n      });\n      const dto = result.data[0];\n\n      expect(dto.id).toBe(notification.id);\n      expect(dto.userId).toBe(notification.userId);\n      expect(dto.type).toBe(NotificationType.TOKEN_RECEIVED);\n      expect(dto.title).toBe('Token Received');\n      expect(dto.isRead).toBe(true);\n      expect(dto.createdAt).toBeInstanceOf(Date);\n    });\n  });\n\n  //  getUnreadCount \n\n  describe('getUnreadCount', () => {\n    const userId = 'user-uuid-1';\n\n    it('should return the correct unread count', async () => {\n      mockRepository.count.mockResolvedValue(7);\n\n      const result = await service.getUnreadCount(userId);\n\n      expect(result).toBe(7);\n      expect(mockRepository.count).toHaveBeenCalledWith({\n        where: { userId, isRead: false },\n      });\n    });\n\n    it('should return 0 when there are no unread notifications', async () => {\n      mockRepository.count.mockResolvedValue(0);\n\n      const result = await service.getUnreadCount(userId);\n\n      expect(result).toBe(0);\n    });\n\n    it('should query with the correct userId', async () => {\n      mockRepository.count.mockResolvedValue(3);\n\n      await service.getUnreadCount('different-user-id');\n\n      expect(mockRepository.count).toHaveBeenCalledWith({\n        where: { userId: 'different-user-id', isRead: false },\n      });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/fetch-notification/notifications.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/create-game-settings.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/create-game.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/get-game-players.dto.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'Max' is defined but never used.","line":1,"column":45,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"Max"},"fix":{"range":[42,47],"text":""},"desc":"Remove unused variable \"Max\"."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { IsOptional, IsBoolean, IsInt, Min, Max } from 'class-validator';\nimport { Type } from 'class-transformer';\nimport { ApiPropertyOptional } from '@nestjs/swagger';\nimport { PaginationDto } from '../../../common/dto/pagination.dto';\n\nexport class GetGamePlayersDto extends PaginationDto {\n  @ApiPropertyOptional({ description: 'Filter by user ID' })\n  @IsOptional()\n  @Type(() => Number)\n  @IsInt()\n  @Min(1)\n  userId?: number;\n\n  @ApiPropertyOptional({ description: 'Filter by in_jail status' })\n  @IsOptional()\n  @Type(() => Boolean)\n  @IsBoolean()\n  inJail?: boolean;\n\n  @ApiPropertyOptional({\n    description: 'Filter to player with active turn (turn_order = 1)',\n  })\n  @IsOptional()\n  @Type(() => Boolean)\n  @IsBoolean()\n  activeTurn?: boolean;\n\n  @ApiPropertyOptional({ description: 'Minimum balance (inclusive)' })\n  @IsOptional()\n  @Type(() => Number)\n  @IsInt()\n  @Min(0)\n  balanceMin?: number;\n\n  @ApiPropertyOptional({ description: 'Maximum balance (inclusive)' })\n  @IsOptional()\n  @Type(() => Number)\n  @IsInt()\n  @Min(0)\n  balanceMax?: number;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/get-games.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/get-user-games.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/join-game.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/lock-balance.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/roll-dice.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/unlock-balance.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/update-game-player.dto.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":40,"column":5,"nodeType":"ConditionalExpression","messageId":"unsafeReturn","endLine":40,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":72,"column":5,"nodeType":"ConditionalExpression","messageId":"unsafeReturn","endLine":72,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":83,"column":5,"nodeType":"ConditionalExpression","messageId":"unsafeReturn","endLine":83,"endColumn":64}],"suppressedMessages":[],"errorCount":3,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  IsEnum,\n  IsOptional,\n  IsString,\n  IsNumber,\n  IsBoolean,\n  MaxLength,\n  Min,\n  IsInt,\n} from 'class-validator';\nimport { Transform, Type } from 'class-transformer';\nimport { ApiPropertyOptional } from '@nestjs/swagger';\nimport { GamePlayerSymbol } from '../enums/game-player-symbol.enum';\n\nexport class UpdateGamePlayerDto {\n  @ApiPropertyOptional({\n    description: 'Player token/symbol (allowed only before game starts)',\n    enum: GamePlayerSymbol,\n  })\n  @IsOptional()\n  @IsEnum(GamePlayerSymbol, {\n    message: `symbol must be one of: ${Object.values(GamePlayerSymbol).join(', ')}`,\n  })\n  symbol?: GamePlayerSymbol;\n\n  @ApiPropertyOptional({ description: 'Player address', maxLength: 120 })\n  @IsOptional()\n  @IsString()\n  @MaxLength(120, { message: 'address cannot exceed 120 characters' })\n  address?: string;\n\n  @ApiPropertyOptional({\n    description: 'Balance (must be positive)',\n    minimum: 1,\n  })\n  @IsOptional()\n  @IsNumber()\n  @Min(1, { message: 'balance must be positive' })\n  @Transform(({ value }) =>\n    typeof value === 'string' ? parseFloat(value) : value,\n  )\n  balance?: number;\n\n  @ApiPropertyOptional({\n    description: 'Board position',\n    minimum: 0,\n  })\n  @IsOptional()\n  @IsInt()\n  @Min(0, { message: 'position must be >= 0' })\n  @Type(() => Number)\n  position?: number;\n\n  @ApiPropertyOptional({\n    description: 'Turn order (1-based position in play order)',\n    minimum: 0,\n  })\n  @IsOptional()\n  @IsInt()\n  @Min(0, { message: 'turn_order must be >= 0' })\n  @Type(() => Number)\n  turn_order?: number;\n\n  @ApiPropertyOptional({\n    description: 'Trade locked balance (must be >= 0)',\n    minimum: 0,\n  })\n  @IsOptional()\n  @IsNumber()\n  @Min(0, { message: 'trade_locked_balance must be >= 0' })\n  @Transform(({ value }) =>\n    typeof value === 'string' ? parseFloat(value) : value,\n  )\n  trade_locked_balance?: number;\n\n  /** Admin/system only */\n  @ApiPropertyOptional({\n    description: 'Whether player is in jail (admin only)',\n  })\n  @IsOptional()\n  @IsBoolean()\n  @Transform(({ value }) =>\n    value === 'true' ? true : value === 'false' ? false : value,\n  )\n  in_jail?: boolean;\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/update-game-settings.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/update-game.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/dto/update-turn.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/entities/game-player.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/entities/game-settings.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/entities/game.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/enums/game-player-symbol.enum.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/game-players.controller.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'RollDiceDto' is defined but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"RollDiceDto"},"fix":{"range":[275,325],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import {\n  Body,\n  Controller,\n  Get,\n  Param,\n  Post,\n  ParseIntPipe,\n} from '@nestjs/common';\nimport { GamePlayersService } from './game-players.service';\nimport { LockBalanceDto } from './dto/lock-balance.dto';\nimport { UnlockBalanceDto } from './dto/unlock-balance.dto';\nimport { RollDiceDto } from './dto/roll-dice.dto';\n\n@Controller('game-players')\nexport class GamePlayersController {\n  constructor(private readonly gamePlayersService: GamePlayersService) {}\n\n  @Get(':id/available-balance')\n  async getAvailableBalance(@Param('id', ParseIntPipe) id: number) {\n    const player = await this.gamePlayersService.findOne(id);\n    const available = this.gamePlayersService.getAvailableBalance(player);\n    return { playerId: id, availableBalance: available };\n  }\n\n  @Post(':id/lock-balance')\n  async lockBalance(\n    @Param('id', ParseIntPipe) id: number,\n    @Body() dto: LockBalanceDto,\n  ) {\n    const player = await this.gamePlayersService.lockBalance(id, dto.amount);\n    return {\n      playerId: player.id,\n      balance: player.balance,\n      tradeLockedBalance: player.trade_locked_balance,\n      availableBalance: this.gamePlayersService.getAvailableBalance(player),\n    };\n  }\n\n  @Post(':id/unlock-balance')\n  async unlockBalance(\n    @Param('id', ParseIntPipe) id: number,\n    @Body() dto: UnlockBalanceDto,\n  ) {\n    const player = await this.gamePlayersService.unlockBalance(id, dto.amount);\n    return {\n      playerId: player.id,\n      balance: player.balance,\n      tradeLockedBalance: player.trade_locked_balance,\n      availableBalance: this.gamePlayersService.getAvailableBalance(player),\n    };\n  }\n}\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/game-players.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async arrow function has no 'await' expression.","line":144,"column":60,"nodeType":"ArrowFunctionExpression","messageId":"missingAwait","endLine":144,"endColumn":62,"suggestions":[{"messageId":"removeAsync","fix":{"range":[3911,3917],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":144,"column":63,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":144,"endColumn":64},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async arrow function has no 'await' expression.","line":147,"column":26,"nodeType":"ArrowFunctionExpression","messageId":"missingAwait","endLine":147,"endColumn":28,"suggestions":[{"messageId":"removeAsync","fix":{"range":[4056,4062],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":147,"column":29,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":147,"endColumn":37},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":152,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":152,"endColumn":39},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":157,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":157,"endColumn":39},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":158,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":159,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":159,"column":19,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":159,"endColumn":20},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":172,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":172,"endColumn":33},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async arrow function has no 'await' expression.","line":246,"column":60,"nodeType":"ArrowFunctionExpression","messageId":"missingAwait","endLine":246,"endColumn":62,"suggestions":[{"messageId":"removeAsync","fix":{"range":[6849,6855],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":246,"column":63,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":246,"endColumn":64},{"ruleId":"@typescript-eslint/require-await","severity":2,"message":"Async arrow function has no 'await' expression.","line":249,"column":26,"nodeType":"ArrowFunctionExpression","messageId":"missingAwait","endLine":249,"endColumn":28,"suggestions":[{"messageId":"removeAsync","fix":{"range":[6994,7000],"text":""},"desc":"Remove 'async'."}]},{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":249,"column":29,"nodeType":"Identifier","messageId":"unsafeReturn","endLine":249,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":254,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":255,"endColumn":21},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":255,"column":19,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":255,"endColumn":20}],"suppressedMessages":[],"errorCount":15,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { Test, TestingModule } from '@nestjs/testing';\nimport { getRepositoryToken } from '@nestjs/typeorm';\nimport { Repository } from 'typeorm';\nimport { GamePlayersService } from './game-players.service';\nimport { Game } from './entities/game.entity';\nimport { GamePlayer } from './entities/game-player.entity';\nimport { PaginationService } from '../../common/services/pagination.service';\n\ndescribe('GamePlayersService', () => {\n  let service: GamePlayersService;\n  let gameRepository: Repository<Game>;\n  let gamePlayerRepository: Repository<GamePlayer>;\n\n  const mockGameRepository = {\n    findOne: jest.fn(),\n    save: jest.fn(),\n  };\n\n  const mockGamePlayerRepository = {\n    find: jest.fn(),\n    save: jest.fn(),\n  };\n\n  const mockPaginationService = {\n    paginate: jest.fn(),\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        GamePlayersService,\n        {\n          provide: getRepositoryToken(Game),\n          useValue: mockGameRepository,\n        },\n        {\n          provide: getRepositoryToken(GamePlayer),\n          useValue: mockGamePlayerRepository,\n        },\n        {\n          provide: PaginationService,\n          useValue: mockPaginationService,\n        },\n      ],\n    }).compile();\n\n    service = module.get<GamePlayersService>(GamePlayersService);\n    gameRepository = module.get<Repository<Game>>(getRepositoryToken(Game));\n    gamePlayerRepository = module.get<Repository<GamePlayer>>(\n      getRepositoryToken(GamePlayer),\n    );\n  });\n\n  afterEach(() => {\n    jest.clearAllMocks();\n  });\n\n  describe('advanceTurn', () => {\n    it('rotates to the next non-jailed player and updates next_player_id', async () => {\n      const game: Game = {\n        id: 1,\n        code: 'ABC123',\n        mode: null,\n        creator_id: 1,\n        status: null,\n        winner_id: null,\n        number_of_players: 3,\n        next_player_id: 1,\n        created_at: new Date(),\n        updated_at: new Date(),\n        is_ai: false,\n        is_minipay: false,\n        chain: null,\n        duration: null,\n        started_at: null,\n        contract_game_id: null,\n        placements: null,\n        creator: null,\n        winner: null,\n        nextPlayer: null,\n      } as unknown as Game;\n\n      const players: GamePlayer[] = [\n        {\n          id: 1,\n          game_id: 1,\n          user_id: 1,\n          symbol: 'A',\n          position: 0,\n          balance: 0,\n          in_jail: false,\n          in_jail_rolls: 0,\n          circle: 0,\n          turn_order: 1,\n          turn_start: '100',\n          consecutive_timeouts: 0,\n          turn_count: 0,\n          last_timeout_turn_start: null,\n          trade_locked_balance: '0.00',\n          rolled: null,\n          address: null,\n        } as unknown as GamePlayer,\n        {\n          id: 2,\n          game_id: 1,\n          user_id: 2,\n          symbol: 'B',\n          position: 0,\n          balance: 0,\n          in_jail: true,\n          in_jail_rolls: 0,\n          circle: 0,\n          turn_order: 2,\n          turn_start: null,\n          consecutive_timeouts: 0,\n          turn_count: 0,\n          last_timeout_turn_start: null,\n          trade_locked_balance: '0.00',\n          rolled: null,\n          address: null,\n        } as unknown as GamePlayer,\n        {\n          id: 3,\n          game_id: 1,\n          user_id: 3,\n          symbol: 'C',\n          position: 0,\n          balance: 0,\n          in_jail: false,\n          in_jail_rolls: 0,\n          circle: 0,\n          turn_order: 3,\n          turn_start: null,\n          consecutive_timeouts: 0,\n          turn_count: 0,\n          last_timeout_turn_start: null,\n          trade_locked_balance: '0.00',\n          rolled: null,\n          address: null,\n        } as unknown as GamePlayer,\n      ];\n\n      mockGameRepository.findOne.mockResolvedValue(game);\n      mockGameRepository.save.mockImplementation(async (g) => g);\n      mockGamePlayerRepository.find.mockResolvedValue(players);\n      mockGamePlayerRepository.save.mockImplementation(\n        async (entities) => entities,\n      );\n\n      await service.advanceTurn(1, 1, { isTimeout: false, now: '200' });\n\n      expect(gamePlayerRepository.find).toHaveBeenCalledWith({\n        where: { game_id: 1 },\n        order: { turn_order: 'ASC' },\n      });\n\n      expect(gamePlayerRepository.save).toHaveBeenCalledTimes(1);\n      const savedArgs = (gamePlayerRepository.save as jest.Mock).mock\n        .calls[0][0];\n      const [savedCurrent, savedNext] = savedArgs as GamePlayer[];\n\n      expect(savedCurrent.user_id).toBe(1);\n      expect(savedCurrent.turn_start).toBeNull();\n      expect(savedCurrent.consecutive_timeouts).toBe(0);\n\n      expect(savedNext.user_id).toBe(3);\n      expect(savedNext.turn_start).toBe('200');\n      expect(savedNext.turn_count).toBe(1);\n      expect(savedNext.consecutive_timeouts).toBe(0);\n      expect(savedNext.rolled).toBe(0);\n\n      expect(gameRepository.save).toHaveBeenCalledWith(\n        expect.objectContaining({\n          id: 1,\n          next_player_id: 3,\n        }),\n      );\n    });\n\n    it('increments consecutive_timeouts on timeout', async () => {\n      const game: Game = {\n        id: 1,\n        code: 'ABC123',\n        mode: null,\n        creator_id: 1,\n        status: null,\n        winner_id: null,\n        number_of_players: 2,\n        next_player_id: 1,\n        created_at: new Date(),\n        updated_at: new Date(),\n        is_ai: false,\n        is_minipay: false,\n        chain: null,\n        duration: null,\n        started_at: null,\n        contract_game_id: null,\n        placements: null,\n        creator: null,\n        winner: null,\n        nextPlayer: null,\n      } as unknown as Game;\n\n      const players: GamePlayer[] = [\n        {\n          id: 1,\n          game_id: 1,\n          user_id: 1,\n          symbol: 'A',\n          position: 0,\n          balance: 0,\n          in_jail: false,\n          in_jail_rolls: 0,\n          circle: 0,\n          turn_order: 1,\n          turn_start: '100',\n          consecutive_timeouts: 1,\n          turn_count: 0,\n          last_timeout_turn_start: null,\n          trade_locked_balance: '0.00',\n          rolled: null,\n          address: null,\n        } as unknown as GamePlayer,\n        {\n          id: 2,\n          game_id: 1,\n          user_id: 2,\n          symbol: 'B',\n          position: 0,\n          balance: 0,\n          in_jail: false,\n          in_jail_rolls: 0,\n          circle: 0,\n          turn_order: 2,\n          turn_start: null,\n          consecutive_timeouts: 0,\n          turn_count: 0,\n          last_timeout_turn_start: null,\n          trade_locked_balance: '0.00',\n          rolled: null,\n          address: null,\n        } as unknown as GamePlayer,\n      ];\n\n      mockGameRepository.findOne.mockResolvedValue(game);\n      mockGameRepository.save.mockImplementation(async (g) => g);\n      mockGamePlayerRepository.find.mockResolvedValue(players);\n      mockGamePlayerRepository.save.mockImplementation(\n        async (entities) => entities,\n      );\n\n      await service.advanceTurn(1, 1, { isTimeout: true, now: '200' });\n\n      const savedArgs = (gamePlayerRepository.save as jest.Mock).mock\n        .calls[0][0];\n      const [savedCurrent, savedNext] = savedArgs as GamePlayer[];\n\n      expect(savedCurrent.user_id).toBe(1);\n      expect(savedCurrent.consecutive_timeouts).toBe(2);\n      expect(savedCurrent.last_timeout_turn_start).toBe('100');\n      expect(savedCurrent.turn_start).toBeNull();\n\n      expect(savedNext.user_id).toBe(2);\n      expect(savedNext.turn_start).toBe('200');\n      expect(savedNext.turn_count).toBe(1);\n      expect(savedNext.rolled).toBe(0);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/game-players.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/games.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/games.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/games.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/games/games.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/dto/get-notifications-query.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/dto/notification-count.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/entities/notification.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/get-notifications-query.dto.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/get-notifications-query.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notification-count.dto.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notification-count.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notification.entity.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":2,"message":"'validNotificationData' is assigned a value but never used.","line":16,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isRequired on an `any` value.","line":87,"column":32,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":87,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isRequired on an `any` value.","line":93,"column":37,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":93,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .isRequired on an `any` value.","line":99,"column":35,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":99,"endColumn":45}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/modules/notifications/entities/notification.entity.spec.ts\nimport { getModelToken } from '@nestjs/mongoose';\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { Model } from 'mongoose';\nimport {\n  Notification,\n  NotificationSchema,\n  NotificationType,\n} from './notification.entity';\n\nconst MOCK_OBJECT_ID = '507f1f77bcf86cd799439011';\n\ndescribe('Notification Entity', () => {\n  let model: Model<Notification>;\n\n  const validNotificationData = {\n    type: NotificationType.NEW_MESSAGE,\n    recipientId: MOCK_OBJECT_ID,\n    message: 'You have a new message',\n    isRead: false,\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        {\n          provide: getModelToken(Notification.name),\n          useValue: {\n            create: jest.fn(),\n            find: jest.fn(),\n            findById: jest.fn(),\n            findOne: jest.fn(),\n          },\n        },\n      ],\n    }).compile();\n\n    model = module.get<Model<Notification>>(getModelToken(Notification.name));\n  });\n\n  it('should be defined', () => {\n    expect(model).toBeDefined();\n  });\n\n  describe('NotificationType enum', () => {\n    it('should contain all expected message notification types', () => {\n      expect(NotificationType.NEW_MESSAGE).toBe('NEW_MESSAGE');\n      expect(NotificationType.MESSAGE_MENTION).toBe('MESSAGE_MENTION');\n      expect(NotificationType.CONVERSATION_INVITE).toBe('CONVERSATION_INVITE');\n    });\n\n    it('should contain all expected transfer notification types', () => {\n      expect(NotificationType.TRANSFER_RECEIVED).toBe('TRANSFER_RECEIVED');\n      expect(NotificationType.TRANSFER_SENT).toBe('TRANSFER_SENT');\n      expect(NotificationType.TRANSFER_COMPLETED).toBe('TRANSFER_COMPLETED');\n      expect(NotificationType.TRANSFER_FAILED).toBe('TRANSFER_FAILED');\n    });\n\n    it('should contain all expected system notification types', () => {\n      expect(NotificationType.SYSTEM_ALERT).toBe('SYSTEM_ALERT');\n      expect(NotificationType.SYSTEM_UPDATE).toBe('SYSTEM_UPDATE');\n      expect(NotificationType.SECURITY_ALERT).toBe('SECURITY_ALERT');\n    });\n\n    it('should contain all expected social notification types', () => {\n      expect(NotificationType.FRIEND_REQUEST).toBe('FRIEND_REQUEST');\n      expect(NotificationType.FRIEND_ACCEPTED).toBe('FRIEND_ACCEPTED');\n      expect(NotificationType.USER_FOLLOWED).toBe('USER_FOLLOWED');\n    });\n  });\n\n  describe('NotificationSchema', () => {\n    it('should have a compound index on recipientId, isRead, createdAt', () => {\n      const indexes = NotificationSchema.indexes();\n      const compoundIndex = indexes.find(\n        ([fields]) =>\n          'recipientId' in fields &&\n          'isRead' in fields &&\n          'createdAt' in fields,\n      );\n      expect(compoundIndex).toBeDefined();\n    });\n\n    it('should require the type field', () => {\n      const typePath = NotificationSchema.path('type');\n      expect(typePath).toBeDefined();\n      expect((typePath as any).isRequired).toBe(true);\n    });\n\n    it('should require the recipientId field', () => {\n      const recipientPath = NotificationSchema.path('recipientId');\n      expect(recipientPath).toBeDefined();\n      expect((recipientPath as any).isRequired).toBe(true);\n    });\n\n    it('should require the message field', () => {\n      const messagePath = NotificationSchema.path('message');\n      expect(messagePath).toBeDefined();\n      expect((messagePath as any).isRequired).toBe(true);\n    });\n\n    it('should default isRead to false', () => {\n      const isReadPath = NotificationSchema.path('isRead');\n      expect(isReadPath.defaultValue).toBe(false);\n    });\n\n    it('should have timestamps enabled', () => {\n      const options = NotificationSchema.options;\n      expect(options.timestamps).toBe(true);\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notification.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.controller.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-return","severity":2,"message":"Unsafe return of a value of type `any`.","line":13,"column":3,"nodeType":"TSAsExpression","messageId":"unsafeReturn","endLine":13,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":43,"column":17,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":43,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .user on an `any` value.","line":44,"column":15,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":44,"endColumn":19},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `PaginatedNotificationsResult | Promise<PaginatedNotificationsResult>`.","line":77,"column":48,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":77,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":79,"column":56,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":79,"endColumn":69},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":81,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":81,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `PaginatedNotificationsResult | Promise<PaginatedNotificationsResult>`.","line":86,"column":48,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":86,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":88,"column":41,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":88,"endColumn":70},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":90,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":90,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `PaginatedNotificationsResult | Promise<PaginatedNotificationsResult>`.","line":97,"column":48,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":97,"endColumn":70},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":98,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":98,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":100,"column":41,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":100,"endColumn":51},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":102,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":102,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `PaginatedNotificationsResult | Promise<PaginatedNotificationsResult>`.","line":115,"column":48,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":115,"endColumn":66},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":117,"column":56,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":117,"endColumn":69},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":129,"column":37,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":129,"endColumn":50},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `PaginatedNotificationsResult | Promise<PaginatedNotificationsResult>`.","line":135,"column":48,"nodeType":"TSAsExpression","messageId":"unsafeArgument","endLine":139,"endColumn":15},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":141,"column":41,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":141,"endColumn":54},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":143,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":143,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":157,"column":54,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":157,"endColumn":67},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":159,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":159,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":166,"column":54,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":166,"endColumn":67},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":173,"column":13,"nodeType":"VariableDeclarator","messageId":"anyAssignment","endLine":173,"endColumn":65},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":175,"column":39,"nodeType":"Identifier","messageId":"unsafeArgument","endLine":175,"endColumn":49},{"ruleId":"@typescript-eslint/unbound-method","severity":2,"message":"A method that is not declared with `this: void` may cause unintentional scoping of `this` when separated from its object.\nConsider using an arrow function or explicitly `.bind()`ing the method to avoid calling the method with an unintended `this` value. \nIf a function does not access `this`, it can be annotated with `this: void`.","line":177,"column":14,"nodeType":"MemberExpression","messageId":"unboundWithoutThisAnnotation","endLine":177,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-argument","severity":1,"message":"Unsafe argument of type `any` assigned to a parameter of type `Request<ParamsDictionary, any, any, ParsedQs, Record<string, any>>`.","line":183,"column":46,"nodeType":"CallExpression","messageId":"unsafeArgument","endLine":183,"endColumn":59}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":15,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/modules/notifications/notifications.controller.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { ExecutionContext } from '@nestjs/common';\nimport { NotificationsController } from './notifications.controller';\nimport { NotificationsService } from './notifications.service';\nimport { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';\nimport { GetNotificationsQueryDto } from './dto/get-notifications-query.dto';\nimport { NotificationType } from './entities/notification.entity';\n\nconst MOCK_USER_ID = '507f1f77bcf86cd799439011';\n\nconst mockRequest = (userId = MOCK_USER_ID) =>\n  ({ user: { id: userId } }) as any;\n\nconst mockNotification = {\n  _id: '665abc123def456789000001',\n  type: NotificationType.NEW_MESSAGE,\n  recipientId: MOCK_USER_ID,\n  message: 'You have a new message',\n  isRead: false,\n  createdAt: new Date('2025-02-20T10:00:00Z'),\n};\n\ndescribe('NotificationsController', () => {\n  let controller: NotificationsController;\n  let service: jest.Mocked<NotificationsService>;\n\n  const mockNotificationsService: jest.Mocked<Partial<NotificationsService>> = {\n    findAllForUser: jest.fn(),\n    countUnreadForUser: jest.fn(),\n  };\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      controllers: [NotificationsController],\n      providers: [\n        { provide: NotificationsService, useValue: mockNotificationsService },\n      ],\n    })\n      .overrideGuard(JwtAuthGuard)\n      .useValue({\n        canActivate: (context: ExecutionContext) => {\n          const req = context.switchToHttp().getRequest();\n          req.user = { id: MOCK_USER_ID };\n          return true;\n        },\n      })\n      .compile();\n\n    controller = module.get<NotificationsController>(NotificationsController);\n    service = module.get(NotificationsService);\n  });\n\n  afterEach(() => jest.clearAllMocks());\n\n  it('should be defined', () => {\n    expect(controller).toBeDefined();\n  });\n\n  // ---------------------------------------------------------------------------\n  // GET /api/notifications\n  // ---------------------------------------------------------------------------\n  describe('getNotifications', () => {\n    const query: GetNotificationsQueryDto = { page: 1, limit: 20 };\n\n    const paginatedResult = {\n      data: [mockNotification],\n      total: 1,\n      page: 1,\n      limit: 20,\n      totalPages: 1,\n      hasNextPage: false,\n      hasPreviousPage: false,\n    };\n\n    it('should return paginated notifications', async () => {\n      service.findAllForUser.mockResolvedValue(paginatedResult as any);\n\n      const result = await controller.getNotifications(mockRequest(), query);\n\n      expect(service.findAllForUser).toHaveBeenCalledWith(MOCK_USER_ID, query);\n      expect(result).toEqual(paginatedResult);\n    });\n\n    it('should pass the correct userId from req.user.id', async () => {\n      service.findAllForUser.mockResolvedValue(paginatedResult as any);\n\n      await controller.getNotifications(mockRequest('custom-user-id'), query);\n\n      expect(service.findAllForUser).toHaveBeenCalledWith(\n        'custom-user-id',\n        query,\n      );\n    });\n\n    it('should fall back to req.user.sub when id is not present', async () => {\n      service.findAllForUser.mockResolvedValue(paginatedResult as any);\n      const subRequest = { user: { sub: 'sub-user-id' } } as any;\n\n      await controller.getNotifications(subRequest, query);\n\n      expect(service.findAllForUser).toHaveBeenCalledWith('sub-user-id', query);\n    });\n\n    it('should return empty data array when user has no notifications', async () => {\n      const emptyResult = {\n        data: [],\n        total: 0,\n        page: 1,\n        limit: 20,\n        totalPages: 0,\n        hasNextPage: false,\n        hasPreviousPage: false,\n      };\n      service.findAllForUser.mockResolvedValue(emptyResult as any);\n\n      const result = await controller.getNotifications(mockRequest(), query);\n\n      expect(result.data).toHaveLength(0);\n      expect(result.total).toBe(0);\n    });\n\n    it('should propagate service errors', async () => {\n      service.findAllForUser.mockRejectedValue(\n        new Error('DB connection failed'),\n      );\n\n      await expect(\n        controller.getNotifications(mockRequest(), query),\n      ).rejects.toThrow('DB connection failed');\n    });\n\n    it('should pass custom pagination params to service', async () => {\n      const customQuery: GetNotificationsQueryDto = { page: 3, limit: 10 };\n      service.findAllForUser.mockResolvedValue({\n        ...paginatedResult,\n        page: 3,\n        limit: 10,\n      } as any);\n\n      await controller.getNotifications(mockRequest(), customQuery);\n\n      expect(service.findAllForUser).toHaveBeenCalledWith(\n        MOCK_USER_ID,\n        customQuery,\n      );\n    });\n  });\n\n  // ---------------------------------------------------------------------------\n  // GET /api/notifications/count\n  // ---------------------------------------------------------------------------\n  describe('getUnreadCount', () => {\n    it('should return the unread count', async () => {\n      service.countUnreadForUser.mockResolvedValue({ count: 5 });\n\n      const result = await controller.getUnreadCount(mockRequest());\n\n      expect(service.countUnreadForUser).toHaveBeenCalledWith(MOCK_USER_ID);\n      expect(result).toEqual({ count: 5 });\n    });\n\n    it('should return count of 0 when there are no unread notifications', async () => {\n      service.countUnreadForUser.mockResolvedValue({ count: 0 });\n\n      const result = await controller.getUnreadCount(mockRequest());\n\n      expect(result).toEqual({ count: 0 });\n    });\n\n    it('should fall back to req.user.sub when id is not present', async () => {\n      service.countUnreadForUser.mockResolvedValue({ count: 3 });\n      const subRequest = { user: { sub: 'sub-user-id' } } as any;\n\n      await controller.getUnreadCount(subRequest);\n\n      expect(service.countUnreadForUser).toHaveBeenCalledWith('sub-user-id');\n    });\n\n    it('should propagate service errors', async () => {\n      service.countUnreadForUser.mockRejectedValue(new Error('Redis timeout'));\n\n      await expect(controller.getUnreadCount(mockRequest())).rejects.toThrow(\n        'Redis timeout',\n      );\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.module.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.service.spec.ts","messages":[{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .save on an `any` value. `this` is typed as `any`.\nYou can try to fix this by turning on the `noImplicitThis` compiler option, or adding a `this` parameter to the function.","line":47,"column":10,"nodeType":"Identifier","messageId":"unsafeThisMemberExpression","endLine":47,"endColumn":14},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":65,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":65,"endColumn":28},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":66,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":66,"endColumn":38},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .findOneAndUpdate on an `any` value.","line":67,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":67,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .updateMany on an `any` value.","line":68,"column":24,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":68,"endColumn":34},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":88,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":88,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":88,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":88,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":89,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":89,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":89,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":89,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":93,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":93,"endColumn":37},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":103,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":103,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":103,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":103,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":104,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":104,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":104,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":104,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":115,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":115,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":115,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":115,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":116,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":116,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":116,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":116,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":128,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":128,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":128,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":128,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":129,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":129,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":129,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":129,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":140,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":140,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":140,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":140,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":141,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":141,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":141,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":141,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":153,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":153,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":153,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":153,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":154,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":154,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":154,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":154,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":163,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":163,"endColumn":46},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .find on an `any` value.","line":163,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":163,"endColumn":30},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":164,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":164,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":164,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":164,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":179,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":179,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":179,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":179,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":183,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":183,"endColumn":47},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":191,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":191,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .countDocuments on an `any` value.","line":191,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":191,"endColumn":40},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":209,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":209,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .findOneAndUpdate on an `any` value.","line":209,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":209,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .findOneAndUpdate on an `any` value.","line":216,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":216,"endColumn":49},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":229,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":229,"endColumn":58},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .findOneAndUpdate on an `any` value.","line":229,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":229,"endColumn":42},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":242,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":242,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .updateMany on an `any` value.","line":242,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":242,"endColumn":36},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .updateMany on an `any` value.","line":246,"column":33,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":246,"endColumn":43},{"ruleId":"@typescript-eslint/no-unsafe-call","severity":2,"message":"Unsafe call of an `any` typed value.","line":254,"column":7,"nodeType":"MemberExpression","messageId":"unsafeCall","endLine":254,"endColumn":54},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access .updateMany on an `any` value.","line":254,"column":26,"nodeType":"Identifier","messageId":"unsafeMemberExpression","endLine":254,"endColumn":36}],"suppressedMessages":[],"errorCount":49,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// src/modules/notifications/notifications.service.spec.ts\nimport { Test, TestingModule } from '@nestjs/testing';\nimport { getModelToken } from '@nestjs/mongoose';\nimport { NotificationsService } from './notifications.service';\nimport { Notification, NotificationType } from './entities/notification.entity';\nimport { GetNotificationsQueryDto } from './dto/get-notifications-query.dto';\n\nconst MOCK_USER_ID = '507f1f77bcf86cd799439011';\n\nconst mockNotification = {\n  _id: '665abc123def456789000001',\n  type: NotificationType.NEW_MESSAGE,\n  recipientId: MOCK_USER_ID,\n  message: 'You have a new message',\n  isRead: false,\n  createdAt: new Date('2025-02-20T10:00:00Z'),\n};\n\n// Helper to build a chainable Mongoose query mock\nfunction buildQueryMock(resolveValue: unknown) {\n  const chain = {\n    sort: jest.fn().mockReturnThis(),\n    skip: jest.fn().mockReturnThis(),\n    limit: jest.fn().mockReturnThis(),\n    lean: jest.fn().mockReturnThis(),\n    exec: jest.fn().mockResolvedValue(resolveValue),\n  };\n  return chain;\n}\n\ndescribe('NotificationsService', () => {\n  let service: NotificationsService;\n\n  const mockNotificationModel = {\n    find: jest.fn(),\n    countDocuments: jest.fn(),\n    findOneAndUpdate: jest.fn(),\n    updateMany: jest.fn(),\n    save: jest.fn(),\n    // Constructor mock\n    prototype: { save: jest.fn() },\n  };\n\n  // Allow `new mockNotificationModel(...)` to return a saveable object\n  function MockModel(data: unknown) {\n    Object.assign(this, data);\n    this.save = jest.fn().mockResolvedValue({ ...data });\n  }\n  Object.assign(MockModel, mockNotificationModel);\n\n  beforeEach(async () => {\n    const module: TestingModule = await Test.createTestingModule({\n      providers: [\n        NotificationsService,\n        {\n          provide: getModelToken(Notification.name),\n          useValue: MockModel,\n        },\n      ],\n    }).compile();\n\n    service = module.get<NotificationsService>(NotificationsService);\n\n    // Attach static mocks to constructor\n    (MockModel as any).find = jest.fn();\n    (MockModel as any).countDocuments = jest.fn();\n    (MockModel as any).findOneAndUpdate = jest.fn();\n    (MockModel as any).updateMany = jest.fn();\n  });\n\n  afterEach(() => jest.clearAllMocks());\n\n  it('should be defined', () => {\n    expect(service).toBeDefined();\n  });\n\n  // ---------------------------------------------------------------------------\n  // findAllForUser\n  // ---------------------------------------------------------------------------\n  describe('findAllForUser', () => {\n    const query: GetNotificationsQueryDto = { page: 1, limit: 20 };\n\n    it('should return paginated notifications', async () => {\n      const notifications = [\n        mockNotification,\n        { ...mockNotification, _id: '2' },\n      ];\n      (MockModel as any).find.mockReturnValue(buildQueryMock(notifications));\n      (MockModel as any).countDocuments.mockResolvedValue(2);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, query);\n\n      expect((MockModel as any).find).toHaveBeenCalledWith({\n        recipientId: MOCK_USER_ID,\n      });\n      expect(result.data).toHaveLength(2);\n      expect(result.total).toBe(2);\n      expect(result.page).toBe(1);\n      expect(result.limit).toBe(20);\n    });\n\n    it('should calculate totalPages correctly', async () => {\n      (MockModel as any).find.mockReturnValue(buildQueryMock([]));\n      (MockModel as any).countDocuments.mockResolvedValue(45);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.totalPages).toBe(3); // ceil(45/20) = 3\n    });\n\n    it('should set hasNextPage=true when not on the last page', async () => {\n      (MockModel as any).find.mockReturnValue(buildQueryMock([]));\n      (MockModel as any).countDocuments.mockResolvedValue(50);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.hasNextPage).toBe(true);\n      expect(result.hasPreviousPage).toBe(false);\n    });\n\n    it('should set hasPreviousPage=true when on page > 1', async () => {\n      (MockModel as any).find.mockReturnValue(buildQueryMock([]));\n      (MockModel as any).countDocuments.mockResolvedValue(50);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, {\n        page: 2,\n        limit: 20,\n      });\n\n      expect(result.hasPreviousPage).toBe(true);\n    });\n\n    it('should set hasNextPage=false on the last page', async () => {\n      (MockModel as any).find.mockReturnValue(buildQueryMock([]));\n      (MockModel as any).countDocuments.mockResolvedValue(20);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, {\n        page: 1,\n        limit: 20,\n      });\n\n      expect(result.hasNextPage).toBe(false);\n    });\n\n    it('should call find with the correct skip value for page 3', async () => {\n      const findMock = buildQueryMock([]);\n      (MockModel as any).find.mockReturnValue(findMock);\n      (MockModel as any).countDocuments.mockResolvedValue(100);\n\n      await service.findAllForUser(MOCK_USER_ID, { page: 3, limit: 10 });\n\n      expect(findMock.skip).toHaveBeenCalledWith(20); // (3-1) * 10\n      expect(findMock.limit).toHaveBeenCalledWith(10);\n    });\n\n    it('should return empty data when user has no notifications', async () => {\n      (MockModel as any).find.mockReturnValue(buildQueryMock([]));\n      (MockModel as any).countDocuments.mockResolvedValue(0);\n\n      const result = await service.findAllForUser(MOCK_USER_ID, query);\n\n      expect(result.data).toHaveLength(0);\n      expect(result.total).toBe(0);\n      expect(result.totalPages).toBe(0);\n    });\n  });\n\n  // ---------------------------------------------------------------------------\n  // countUnreadForUser\n  // ---------------------------------------------------------------------------\n  describe('countUnreadForUser', () => {\n    it('should return the unread count', async () => {\n      (MockModel as any).countDocuments.mockResolvedValue(7);\n\n      const result = await service.countUnreadForUser(MOCK_USER_ID);\n\n      expect((MockModel as any).countDocuments).toHaveBeenCalledWith({\n        recipientId: MOCK_USER_ID,\n        isRead: false,\n      });\n      expect(result).toEqual({ count: 7 });\n    });\n\n    it('should return 0 when there are no unread notifications', async () => {\n      (MockModel as any).countDocuments.mockResolvedValue(0);\n\n      const result = await service.countUnreadForUser(MOCK_USER_ID);\n\n      expect(result).toEqual({ count: 0 });\n    });\n  });\n\n  // ---------------------------------------------------------------------------\n  // markAsRead\n  // ---------------------------------------------------------------------------\n  describe('markAsRead', () => {\n    it('should update and return the notification', async () => {\n      const updated = { ...mockNotification, isRead: true };\n      const chain = {\n        lean: jest.fn().mockReturnThis(),\n        exec: jest.fn().mockResolvedValue(updated),\n      };\n      (MockModel as any).findOneAndUpdate.mockReturnValue(chain);\n\n      const result = await service.markAsRead(\n        mockNotification._id,\n        MOCK_USER_ID,\n      );\n\n      expect((MockModel as any).findOneAndUpdate).toHaveBeenCalledWith(\n        { _id: mockNotification._id, recipientId: MOCK_USER_ID },\n        { isRead: true },\n        { new: true },\n      );\n      expect(result).toEqual(updated);\n    });\n\n    it('should return null when notification is not found', async () => {\n      const chain = {\n        lean: jest.fn().mockReturnThis(),\n        exec: jest.fn().mockResolvedValue(null),\n      };\n      (MockModel as any).findOneAndUpdate.mockReturnValue(chain);\n\n      const result = await service.markAsRead('nonexistent-id', MOCK_USER_ID);\n\n      expect(result).toBeNull();\n    });\n  });\n\n  // ---------------------------------------------------------------------------\n  // markAllAsRead\n  // ---------------------------------------------------------------------------\n  describe('markAllAsRead', () => {\n    it('should mark all unread notifications as read and return modifiedCount', async () => {\n      (MockModel as any).updateMany.mockResolvedValue({ modifiedCount: 5 });\n\n      const result = await service.markAllAsRead(MOCK_USER_ID);\n\n      expect((MockModel as any).updateMany).toHaveBeenCalledWith(\n        { recipientId: MOCK_USER_ID, isRead: false },\n        { isRead: true },\n      );\n      expect(result).toEqual({ modifiedCount: 5 });\n    });\n\n    it('should return modifiedCount of 0 when nothing was unread', async () => {\n      (MockModel as any).updateMany.mockResolvedValue({ modifiedCount: 0 });\n\n      const result = await service.markAllAsRead(MOCK_USER_ID);\n\n      expect(result).toEqual({ modifiedCount: 0 });\n    });\n  });\n});\n","usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/notfications/notifications.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/create-property.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/get-properties.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/rent-structure-response.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/toggle-mortgage.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/update-property.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/dto/update-rent-structure.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/entities/property.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/properties.controller.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/properties.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/properties.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/properties.service.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/properties/properties.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/redis/redis.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/redis/redis.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/dto/create-user.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/dto/update-user.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/dto/user-profile.dto.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/entities/user.entity.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/users.controller.spec.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/users.controller.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/users.module.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/users.service.spec.ts","messages":[],"suppressedMessages":[{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":159,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":159,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":161,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":161,"endColumn":41,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":163,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":163,"endColumn":42,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":165,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":165,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-assignment","severity":2,"message":"Unsafe assignment of an `any` value.","line":167,"column":11,"nodeType":"Property","messageId":"anyAssignment","endLine":167,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":173,"column":44,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":173,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"@typescript-eslint/no-unsafe-member-access","severity":2,"message":"Unsafe member access [0] on an `any` value.","line":193,"column":44,"nodeType":"Literal","messageId":"unsafeMemberExpression","endLine":193,"endColumn":45,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"/Users/Apple/dev/os/ikem/Tycoon-Monorepo/backend/src/modules/users/users.service.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
